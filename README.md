jdwebsite
=======
[![Build Status](https://travis-ci.org/jonge-democraten/website.svg?branch=master)](https://travis-ci.org/jonge-democraten/website)  
A website application and content management system in development for the [Jonge Democraten](http://jongedemocraten.nl/).  
Based on Python, Django and [Mezzanine](http://mezzanine.jupo.org/). Open-source and under the MIT-licence. 

The project is in the initial development stage. Nothing is stable and everything may change. 

## Contents

- [Installation](#installation)
- [Testing](#testing)
- [Development](#development)
  - [Workflow](#workflow)
  - [Coding standards](#coding-standards)
  - [Logging](#workflow)

## Installation

##### Quick steps
1. `$ ./build_env.sh`
1. `$ source ./env/bin/activate`  
1. `$ python create_local_settings.py`
1. `$ python website/manage.py createdb`
1. `$ python website/manage.py runserver`  

**Linux**  
Installation of the full project, and running a test server, can be done in a few minutes on any Linux machine. Just follow the steps below. It does not require manual configuration.

**Windows**  
For Windows users, it is adviced to install a Linux virtual machine and use this to install the project. Please visit [this](http://www.wikihow.com/Install-Ubuntu-on-VirtualBox) howto for step-by-step instructions to install Ubuntu on VirtualBox. 

**Virtual environment**  
Build a new work environment. This creates a virtual enviroment `env` and installs all required modules,  
`$ ./build_env.sh`  
Activate the virtual enviroment,  
`$ source ./env/bin/activate`  
From now on, everything you do within the project should be from a shell with activated virtual env.

**Configure Django settings**  
A Django settings file, `local_settings.py`, with `SECRET_KEY` is generated by,  
`$ python create_local_settings.py`  

**Create a database**  
You have to create an initial database and a root user and password for the database,  
`(env) $ python website/manage.py createdb`

**Run a test server**  
You can run a local test server with the command,  
`(env) $ python3 website/manage.py runserver`  
You can now visit [127.0.0.1:8000](http://127.0.0.1:8000) in your browser to view the web interface.

**Clean project**  
You can remove the virtual environment and database with,  
`$ ./clean_env.sh`


## Testing 
All application logic code is to be unit tested. Unit tests are ideally created before development of functionality.  
It supports development and documents, in real code instead of text, what classes and functions are supposed to do.
Feature branches are only merged if unit tests are written and all pass.  
Higher level user interface actions are tested manually. 

#### Unit tests
The project uses the [Django unit test](https://docs.djangoproject.com/en/dev/topics/testing/overview/) framework to create unit tests. 
This framework is based on the Python unittest module.  
Tests are defined in the `tests.py` file of the application directory. 

##### Run tests
Tests for the project's Django applications can be run with the following command,  
`(env) $ python website/manage.py test <appname>`

#### Automated testing
[Travis](https://travis-ci.org/jonge-democraten/website) is used to automatically install the environment and run tests on changes in the project.  
The file `.travis.yml` contains the Travis commands to install and test the project.  
The build indicator on top of this document shows the status of the last automated install and tests.


## Development
This section provides some guidelines to ensure consistency within the project and streamline the workflow.  

#### Workflow
New features are developed on a separate feature branch.  
This allows you to work independently on a feature and still share code. Push feature branch commits often to communicate what you are working on.  
Read more about this workflow [here](https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow).

#### Coding standards
The default Python and Django code style is used. Read about it [here](https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/).  
Write code as simple as possible and focus on readability. Write code for others to understand and read.

*"Always code as if the person who ends up maintaining your code is a violent psychopath who knows where you live. "* - [source](http://c2.com/cgi/wiki?CodeForTheMaintainer)

**Flake8**  
Flake8 is a Python tool to check code style. It runs automatically on Travis after each commit.  
You can find the Flake8 output in the [latest Travis build log](https://travis-ci.org/jonge-democraten/website).

#### Logging
The Python logging module is used for logging. Add and commit plenty of useful log statements. This support effective debugging. 

Logging is configured in the Django `settings.py` `LOGGING` variables. Information about configuration you can be found [here](https://docs.djangoproject.com/en/1.7/topics/logging/). New applications have to be added before logging becomes active for those applications. 

##### How to use
To add log statements, simply add the following at the top of your Python file,
```python
import logging
logger = logging.getLogger(__name__)
```
and add a new log statement anywhere in this file by,
```python
logger.debug('debug log statement')
logger.warning('warning message')
logger.error('error message')
```
The log statements include log level, application, class, function and line number of the log statement,
```python
[2014-12-19 22:39:11] ERROR [website.tests::test_logfile() (23)]: Cannot find anything here.
```
##### Levels
Five log levels are available, `logger.debug()`, `logger.info()`, `logger.warning()`, `logger.error()`, `logger.critical()`. 

##### Ouput (console and files)
The log statements for the applications are written to the console, if DEBUG=True, and always to `debug.log` and `error.log`. Django errors can be found in `django.log`.

##### Confidential information 
Confidential information should not be logged. During initial development, logging of confidential information is allowed if marked with a `CONF` tag, `logger.debug('CONF ' + member.DNA)`. These will be removed before deployment. 
